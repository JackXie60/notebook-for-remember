# 导航守卫

在 vue 中已经帮我们实现了导航守卫，但是在 react 并没有实现，需要我们自己去实现导航守卫

> 导航守卫:当进入一个页面，进入一个页面时触发的事件

## 监听器

history 对象

- listen：添加一个监听器，监听地址的变化，当地址发生变化时，会调用出传递的函数
  - 参数:函数，运行时间点：发生在即将跳转到新页面时
    - 参数 1：location 对象，记录当前的地址信息
    - 参数 2：action 对象，一个支付穿，记录当前的地址信息
      - POP
      - PUSH
      - REPLACCE
  - 返回结果：函数可以用于取消监听

```
 useEffect(()=>{
        unlisten = props.history.listen((location,action)=>{
            console.log(location,action)
        })
        return ()=>{
            unlisten();
        }
        // props.history.block('真的要跳转页面吗')
    },[])
```

## 拦截器

block，设置一个阻塞，并同时设置阻塞消息，当页面发生跳转时，会进入阻塞，并将阻塞消息传递到路由跟组件的 getUserConfirmation 方法

- 返回一个回调函数，用于取消阻塞器

```
function _GuardHelper(props){
    useEffect(()=>{
        props.history.block('真的要跳转页面吗')
    },[])
    return null;
}
const GuardHelper = withRouter(_GuardHelper)
```

## 路由根组件

- getUserConfirmation
  - 参数:函数
    - 参数 1：阻塞消息
      - 字符串消息
      - 函数：函数的返回结果时一个字符串，用于表示阻塞消息
        - 参数 1：location 对象
        - 参数 2：action 值
    - 参数 2：回调函数，调用该函数并传递 true，则表示进入到新页面，否则不做任何操作

```
const handleComfirm = function(msg,callback){
        console.log(msg)
        callback(true)
    }
    return (
        <Router getUserConfirmation={handleComfirm}>
            <GuardHelper/>
            {props.children}
        </Router>
    )
```
